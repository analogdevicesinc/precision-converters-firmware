<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Using DMM Tab to Read DC Voltage on Input Channels &#8212; Precision Converters Firmware  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8e8a900e" />
    <link rel="stylesheet" type="text/css" href="../../_static/style.min.css?v=95305861" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script defer="" src="../../_static/app.umd.js?v=c93eadd1"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  
  <meta name="global_root" content="../../../">
  <meta name="repo" content="precision-converters-firmware">
  


<style>
  body {
    
  }

  body.dark {
    
  }

  @media (prefers-color-scheme: dark) {
    body:not(.light) {
      
    }
  }
</style>
  </head><body>
  <div class="banner"></div>
  <input type="checkbox" id="input-show-toc">
  <input type="checkbox" id="input-show-localtoc">
  <input type="checkbox" id="input-show-repotoc">

  
  <div class="search-area">
    <form action="" method="get">
      <input type="text" name="q" aria-labelledby="search-documentation" value="" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="search" placeholder="Search"/>
      <button value="search" class="icon"></button>
      <span id="search-progress"></span>
    </form>
  </div>
  

  <header>
    <div id="left">
      <label id="show-sidebar" class="icon" for="input-show-toc" title="Show/hide index"></label>
    </div>
    <div id="right">
      <span>
        <a id="logo-org" href="https://analog.com"></a>
        <div class="vertical-divider"></div>
        <label id="show-repotoc" for="input-show-repotoc" title="Show/hide docs" tabindex="0">Docs</label>
        <a id="logo" href="../../index.html">
          <div>Precision Converters Firmware</div>
        </a>
      </span>
      <span class="reverse">
        <label id="show-localtoc" class="icon" for="input-show-localtoc" title="Show/hide contents"></label>
      </span>
    </div>
  </header>


  <div class="repotoc-tree overlay">
    <root>
  <a href="../../../documentation/index.html">System Level</a>
  <a href="../../../hdl/index.html">HDL</a>
  <a href="../../../testbenches/index.html">HDL Testbenches</a>
  <a href="../../../pyadi-iio/index.html">Hardware Python Interfaces</a>
  <a href="../../../libiio/index.html">libiio</a>
  <a href="../../../no-OS/index.html">no-OS</a>
  <a href="../../index.html" class="current">Precision Converters Firmware</a>
  <a href="../../../PrecisionToolbox/index.html">Precision Toolbox</a>
  <a href="../../../scopy/index.html">Scopy</a>
  <a href="../../../doctools/index.html">Doctools</a>
</root>

  </div>
    <div class="localtoc">
      <div class="tocwrapper">
        <div>
          <div class="localtoc-header">On this page</div>
          <a id="scroll-up" href="#top-anchor" title="Back to top"></a>
        </div>
        <nav>
          <ul>
<li><a class="reference internal" href="#">Using DMM Tab to Read DC Voltage on Input Channels</a></li>
<li><a class="reference internal" href="#iio-data-capture-for-adcs">IIO Data Capture for ADCs</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#data-capture-from-iio-device">Data Capture from IIO Device</a></li>
<li><a class="reference internal" href="#saving-captured-data">Saving Captured Data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#limitations-of-data-capture-using-iio-application">Limitations of Data Capture Using IIO Application</a></li>
</ul>

        </nav>
      </div>
    </div>

  
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
    <a id="no-logo" href="../../index.html">
      Precision Converters Firmware
    </a><input id="input-switch-toc" type="checkbox">
<label id="show-repotoc" for="input-switch-toc">
All content
</label>
<label id="show-toc" for="input-switch-toc">
Content on this topic
</label>
<div class="repotoc-tree">
  <root>
  <a href="../../../documentation/index.html">System Level</a>
  <a href="../../../hdl/index.html">HDL</a>
  <a href="../../../testbenches/index.html">HDL Testbenches</a>
  <a href="../../../pyadi-iio/index.html">Hardware Python Interfaces</a>
  <a href="../../../libiio/index.html">libiio</a>
  <a href="../../../no-OS/index.html">no-OS</a>
  <a href="../../index.html" class="current">Precision Converters Firmware</a>
  <a href="../../../PrecisionToolbox/index.html">Precision Toolbox</a>
  <a href="../../../scopy/index.html">Scopy</a>
  <a href="../../../doctools/index.html">Doctools</a>
</root>

</div>
<div class="toc-tree">
  <html>
  <body><ul>
<li class="toctree-l1"><a class="reference internal" href="../build/project_build.html">Build Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code_style.html">Code Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing to PCFW Repository</a></li>
<li class="toctree-l1"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-1" id="toctree-collapse-1"/><div class="collapse"><a class="reference internal" href="../projects/index.html">Firmware Applications</a><label for="toctree-collapse-1"><div class="icon"></div></label></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad2s1210_iio/ad2s1210_iio.html">AD2S1210 IIO Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad355xr_iio/ad355xr_iio.html">AD355XR IIO Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad405x_iio/ad405x_iio.html">AD405x IIO Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad4130_iio/ad4130_iio.html">AD4130 IIO Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad4170_iio/ad4170_iio.html">AD4170 IIO Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad4696_iio/ad4696_iio.html">AD4696 IIO Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad559xr_console/ad559xr_console.html">AD559XR Console Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad5754r_iio/ad5754r_iio.html">AD5754R/CN0586 IIO Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad579x_iio/ad579x_iio.html">AD579X IIO Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad590_console/ad590_console.html">AD590 Console Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad5933_console/ad5933_console.html">AD5933 Console Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad7124_console/ad7124_console.html">AD7124 Console Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad7124_iio/ad7124_iio.html">AD7124 IIO Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad7124_temperature-measure/ad7124_temperature-measure.html">AD7124 Temperature Measure Firmware Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad7134_iio/ad7134_iio.html">AD7134 IIO Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad717x_console/ad717x_console.html">AD717x / AD411x Console Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad717x_iio/ad717x_iio.html">AD717x / AD411x IIO Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad719x_iio/ad719x_iio.html">AD719x IIO Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad738x_iio/ad738x_iio.html">AD738x IIO Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad7606_iio/ad7606_iio.html">AD7606 IIO Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad7689_iio/ad7689_iio.html">AD7689 IIO Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad77681_iio/ad77681_iio.html">AD7768-1 IIO Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ad777x_iio/ad777x_iio.html">AD777x IIO Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/adt7420_console/adt7420_console.html">ADT7420 Console Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ltc268x_console/ltc268x_console.html">LTC268x Console Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/ltc2672_iio/ltc2672_iio.html">LTC2672 IIO Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/nanodac_console/nanodac_console.html">nanoDAC+ Console Application</a></li>
</ul>
</li>
</ul>
</body>
</html>

</div>
        </div>
      </div>

  <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper" id="top-anchor">
          <div class="body" role="main">
            
  <section id="using-dmm-tab-to-read-dc-voltage-on-input-channels">
<h1>Using DMM Tab to Read DC Voltage on Input Channels<a class="headerlink" href="#using-dmm-tab-to-read-dc-voltage-on-input-channels" title="Link to this heading">#</a></h1>
<p>DMM tab can be used read the instantaneous voltage applied on analog input channels.
Simply select the device and channels to read and press start button.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The voltage is just instantaneous, so it is not possible to get RMS AC voltage
or averaged DC voltage. Also, when using DMM tab, do not access/use the Data
capture or Debug tab as this could impact data capturing. All uses same
communication bus to access the data which could result into access/busy conflicts
during data capture.</p>
</div>
<a class="reference internal image-reference" href="../../_images/iio_osc_dmm_tab.png"><img alt="../../_images/iio_osc_dmm_tab.png" src="../../_images/iio_osc_dmm_tab.png" style="width: 500px;" />
</a>
</section>
<section id="iio-data-capture-for-adcs">
<h1>IIO Data Capture for ADCs<a class="headerlink" href="#iio-data-capture-for-adcs" title="Link to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>This page focuses on the IIO firmware part of ‘Data Capturing. The “AD7606 IIO Application”
is used as a reference for this discussion.</p>
<p>IIO clients can be used to capture and visualize the continuous analog or
discrete signals from any ADC device using a IIO firmware application developed
for that particular device. This allows user to monitor a real-time data. Using
this firmware, a user can perform device calibration, change the gain, voltage
range, data rate, etc. (based on device used) and observe the effects that different
configurations have on the data displayed on IIO client. IIO clients
also allows users to save the data, which can further be used to process and analyze it.</p>
<p>The diagram below shows the continuous capture of signals on an AD7606 ADC, which
is an 8-channel DAS. A 1Khz signal is applied on inputs of all 8 analog channels.
The max data capturing rate in firmware is ~30 to 40 KSPS. The data is transmitted
from firmware application using Virtual Serial or UART serial link.</p>
<a class="reference internal image-reference" href="../../_images/iio_osc_sine_wave_capture.png"><img alt="../../_images/iio_osc_sine_wave_capture.png" src="../../_images/iio_osc_sine_wave_capture.png" style="width: 800px;" />
</a>
<a class="reference internal image-reference" href="../../_images/iio_osc_trapezoidal_wave_capture.png"><img alt="../../_images/iio_osc_trapezoidal_wave_capture.png" src="../../_images/iio_osc_trapezoidal_wave_capture.png" style="width: 800px;" />
</a>
<p>The channels for which data is to be captured can be selected from the GUI window,
along with the number of samples to display on screen in a single data read query.
As shown below, all 8 channels are selected for data capture and the number of
requested samples is set at 400 (default). This means, IIO oscilloscope requests
400 samples per channel, so in this case total 3200 samples. The channels are
stored as shown below:</p>
<a class="reference internal image-reference" href="../../_images/iio_osc_select_chn_samples.png"><img alt="../../_images/iio_osc_select_chn_samples.png" src="../../_images/iio_osc_select_chn_samples.png" style="width: 800px;" />
</a>
</section>
<section id="data-capture-from-iio-device">
<h2>Data Capture from IIO Device<a class="headerlink" href="#data-capture-from-iio-device" title="Link to this heading">#</a></h2>
<p>To capture the data from IIO device, simply select the device and channels
to read/capture data. The data is plotted as “ADC Raw Value” Vs “Number of Samples”
and is just used for Visualization. The data is read as is from device without
any processing. If user wants to process the data, it must be done externally
by capturing data from the Serial link on controller board.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The DMM or Debug tab should not be accessed when capturing data as this would
impact data capturing. All uses same communication bus to access the data which
could result into access/busy conflicts during data capture.</p>
</div>
<p><em>Time Domain plot:</em></p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/iio_osc_time_domain_plot.png"><img alt="../../_images/iio_osc_time_domain_plot.png" src="../../_images/iio_osc_time_domain_plot.png" style="width: 800px;" />
</a>
</div></blockquote>
<p><em>Frequency Domain plot:</em></p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/iio_osc_freq_domain_plot.png"><img alt="../../_images/iio_osc_freq_domain_plot.png" src="../../_images/iio_osc_freq_domain_plot.png" style="width: 800px;" />
</a>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Select number of samples and channels according to sampling rate of your
device. For very slow ODRs, the data capturing would be too slow and
IIO oscilloscope might become unresponsive waiting for data to be received
from IIO device.</p>
</div>
</section>
<section id="saving-captured-data">
<h2>Saving Captured Data<a class="headerlink" href="#saving-captured-data" title="Link to this heading">#</a></h2>
<p>The data on IIO oscilloscope can be saved for further processing and analysis. The
data is saved using a .csv format. The data can be captured for each selected
channel during save option and only requested number of samples can be saved. So
if 400 samples are requested, the data for only 400 samples would get saved into
.csv file. The data is raw adc data and no extra processing is performed it while
saving or capturing.</p>
<a class="reference internal image-reference" href="../../_images/iio_osc_data_save.png"><img alt="../../_images/iio_osc_data_save.png" src="../../_images/iio_osc_data_save.png" style="width: 600px;" />
</a>
<p>The data saving feature is also available with other IIO client applications such as
python and ACE.</p>
</section>
</section>
<section id="limitations-of-data-capture-using-iio-application">
<h1>Limitations of Data Capture Using IIO Application<a class="headerlink" href="#limitations-of-data-capture-using-iio-application" title="Link to this heading">#</a></h1>
<p>There are 3 major factors which can potentially impact the data capturing:</p>
<ul class="simple">
<li><p>Sampling/Capturing Rate of ADC</p></li>
<li><p>Data Transmission Rate (serial link) of MCU</p></li>
<li><p>Buffer size limitations in the firmware (MCU RAM size)</p></li>
</ul>
<p><strong>ADC Data Sampling/Capturing Rate:</strong></p>
<p>The data capturing or sampling rate defines the maximum rate/speed at which data
can be sampled and captured from the ADC using the IIO firmware application. For
ADC’s, typical time to capture single ADC sample is defined as:</p>
<p>Time to capture single sample: ADC acquisition time + ADC sampling time + ADC data read time over digital interface</p>
<p>For AD7606, this time is typically 28usec for all 8-channels (obtained in IIO firmware).
AD7606 captures all 8-channels in single conversion cycle. When calculating the
sample rate per second, it is obtained as ~284 KSPS for all 8 channels
(28usec / 8 = 3.5usec. Sample rate/second = 1/3.5usec = 284 KSPS). This gives
sample rate per channel as ~35KSPS.</p>
<p>Data capturing rate is also limited because of an additional overhead in the MCU firmware
such as interrupt context switching time, SPI (digital interface) clock frequency, MCU clock speed, etc.</p>
<p>35Khz therefore can be considered as the sampling frequency. As per ‘Nyquist–Shannon sampling theorem’,
the sampling frequency should theoretically be greater than twice the analog input
frequency for faithful reproduction of the signal after conversion. However, in
practice sampling frequency should be high enough to capture multiple slices/samples
in given period, so that the input signal is replicated smoothly.</p>
<p>Due to this limitations, IIO firmware can sample input frequencies which are very
less than max possible data rate. In case of AD7606, it is possible to sample the
signals with frequencies of 4Khz and less when no oversampling is present. At OSR &gt; 0,
the data rate drops down and so higher frequency signals can’t be reproduced correctly.
Below plot is captured with 17Khz analog input on channel 1 and it can be seen that
the signal is not a pure sine wave.</p>
<a class="reference internal image-reference" href="../../_images/iio_osc_high_frequency_graph.png"><img alt="../../_images/iio_osc_high_frequency_graph.png" src="../../_images/iio_osc_high_frequency_graph.png" style="width: 800px;" />
</a>
<p><strong>Data Transmission Rate (serial link) of MCU:</strong></p>
<p>This is the rate or speed at which data can be transmitted to IIO client
over the serial link (e.g. UART or Virtual serial). The data transmission link
must be fast enough the transmit the buffered data from firmware for continuous capture.
The IIO clients requests data in aperiodic manner, meaning that new data
capture request is sent immediately when data from previous request is received.</p>
<p>Capturing Rate &lt; Transmission Rate:</p>
<p>If data capturing rate is lower than transmission rate, the IIO client can wait for
certain period of time before sufficient samples are captured in the buffer. If
time to capture these samples is higher than IIO client timeout period, the
IIO client aborts the request and attempt new capture request. Therefore user must
always ensure that the timeout factor of IIO clients is large enough to handle
slower sampling rates (ODRs) of ADCs.</p>
<p>Main factor that determines the IIO oscilloscope timeout is ‘sampling_frequency’ attribute.
If this attribute is not defined, the timeout period for IIO oscilloscope during
data capture is set to 2sec default, however, if this attribute is defined, the
time is calculated as: number of requested samples * (1 / sampling_frequency).
For example, if sampling frequency is set as 400SPS, the timeout period is:</p>
<p>timeout = 400 (requested samples) * (1 / 10000 SPS) + 1sec = 1.4 sec</p>
<p>There is a fix employed for the above in the latest version of iio-oscilloscope
Please follow the below steps to <strong>increase the timeout</strong> of iio oscilloscope:
* Download the <a class="reference external" href="https://github.com/analogdevicesinc/iio-oscilloscope/actions/runs/8153749871">iio-oscilloscope.exe</a>
* Navigate to the configuration file .osc_profile.ini (This can be usually found at: C:UsersdishaAppDataLocal)
* Add a variable capture_timeout and set it to a value (in ms) suited for your application.</p>
<a class="reference internal image-reference" href="../../_images/osc_ini.png"><img alt="../../_images/osc_ini.png" src="../../_images/osc_ini.png" style="width: 400px;" />
</a>
<p>An example of a minimum  content of a .ini file:
[IIO Oscilloscope]
capture_timeout=5000</p>
<p>Capturing Rate &gt; Transmission Rate:</p>
<p>If data capturing rate is too high compared to the transmission rate, the data
acquisition into a buffer happens faster. So data buffer might fill faster compared
to emptying operation. This might lead to a discontinuity on data visualization
on IIO oscilloscope side as data visualization is limited by data transmission
rate in this case (with slower serial communication link). If communication link
is faster and matches to capturing/sampling rate, the visualization of data would
be more continuous. Having a large data buffer in the firmware can minimize this
issue to large extend but it can’t completely solve the problem.</p>
<p><strong>Buffer size limitations in the firmware:</strong></p>
<p>Size of data buffer on the firmware is always restricted due to MCU memory size.
The requested number of samples from IIO client application therefore must always
be less than the total size of data buffer. If requested samples are more than
the size of data buffer, IIO firmware returns negative error code to IIO client
which then terminates the data capture request.</p>
<p>Buffer size can be increased to larger value by making use of interna/external
RAMs. For example, SDP-K1 MCU board has 16Mbytes of onboard SDRAM, which allows
larger data buffer size in the firmware. By enabling SDRAM in the SDP-K1 targetted
Mbed firmware (app_config.h file), the data buffer size can be increased to 16Mbytes.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Enable/Disable the use of SDRAM for ADC data capture buffer */</span>
<span class="c1">//#define USE_SDRAM     // Uncomment to use SDRAM for data buffer</span>
</pre></div>
</div>
<p>IIO firmware maintains the circular data buffer with dedicated read and write indices.
Below diagram illustrates the use of circular buffer in the firmware.</p>
<a class="reference internal image-reference" href="../../_images/iio_data_capture_in_firmware.png"><img alt="../../_images/iio_data_capture_in_firmware.png" src="../../_images/iio_data_capture_in_firmware.png" style="width: 600px;" />
</a>
</section>


          </div>
              <div class="related">
                &nbsp;
    <div></div>
    <div></div>
              </div>
          
        </div>
      </div>
  </div>

  <div id="vertical-border"></div>

  <label id="cancel-area-show-toc" for="input-show-toc"></label>
  <label id="cancel-area-show-localtoc" for="input-show-localtoc"></label>
    <footer>
      &#169;2023-2024, Analog Devices Inc.
      
      |
      Made with <a href="https://www.sphinx-doc.org/">Sphinx</a>
      &amp; <a href="https://github.com/analogdevicesinc/doctools">Doctools</a>
      
    </footer>
  </body>
</html>